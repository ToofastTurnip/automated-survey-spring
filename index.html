<!DOCTYPE html><html><head><title>Automated Surveys in Spring</title><style>body, html {
  height:100%;
  width:100%;
  padding:0;
  margin:0;
  overflow:hidden;
  background-color:#ddd;
}
.wrapper {
  height:100%;
  width:100%;
}</style><link rel="shortcut icon" href="//twilio.com/bundles/marketing/img/favicons/favicon.ico"><link rel="apple-touch-icon" href="//twilio.com/bundles/marketing/img/favicons/favicon_57.png"><link rel="apple-touch-icon" sizes="72x72" href="//twilio.com/bundles/marketing/img/favicons/favicon_72.png"><link rel="apple-touch-icon" sizes="114x114" href="//twilio.com/bundles/marketing/img/favicons/favicon_114.png"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"><link rel="stylesheet" href="viewsaurus.css"></head><body><div class="wrapper"><div id="viewsaurus" data-title="Automated Surveys in Spring"><div class="saurus-panes"><div class="saurus-prose"><div class="saurus-prose-header"><div class="title-outer"><span class="step-title">Automated Surveys in Spring</span></div></div><div class="saurus-nav-buttons"><div class="saurus-nav-button nav-overview"><div class="saurus-nav-button-inner"><i class="fa fa-fw fa-list"></i></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-previous"><div class="saurus-nav-button-inner"><a href=""> <i class="fa fa-fw fa-play fa-rotate-180"></i></a></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-next clickable"><div class="saurus-nav-button-inner"><a href="#1"> <i class="fa fa-fw fa-play"></i></a></div></div><div class="saurus-next-title"><span class="next-title-inner"></span></div></div><div class="saurus-progress-bar"></div><div class="saurus-start"><p>Learn to implement automated surveys in your Spring web app with Twilio.</p><a href="#0">Start Tutorial</a></div><div class="saurus-content"><div data-title="Setting Up The Application" class="chapter"><div data-tile="What Are We Building?" data-file="src/main/java/com/twilio/survey/SurveyJavaApplication.java" data-highlight="13-36" class="step"><h2 id="automated-survey">Automated Survey</h2>
<p>Have you ever wondered how to create an automated survey that can be answered over phone or SMS?</p>
<p>In this tutorial will show how to do it using Twilio API. </p>
<h4 id="here-s-how-it-works-at-a-high-level">Here&#39;s how it works at a high level</h4>
<p><img src="https://s3.amazonaws.com/howtodocs/automated-survey.png" alt="Automated Survey Diagram"></p>
<ol>
<li><p>The end user calls or texts the survey phone number. </p>
</li>
<li><p>Twilio gets the call or text and makes an HTTP request to your application for instructions on how to respond.</p>
</li>
<li><p>Your web application serves up <a href="/docs/api/twiml">TwiML instructions</a> to <code>Gather</code> or <code>Record</code> the user input over the phone, or prompt for text input with <code>Message</code>.</p>
</li>
<li><p>After each question, Twilio makes another request to your server with the user&#39;s input, which your application stores in its database.</p>
</li>
<li><p>Your application returns a TwiML response to Twilio with instructions to either ask the next question or end the survey.</p>
</li>
</ol>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//spring.io/guides/gs/spring-boot/">Getting Started with Spring Boot</a></li>
<li><a href="https://www.twilio.com/docs/java/install">Getting started with Twilio Java</a></li>
<li><a href="https://www.twilio.com/docs/api/twiml">TwiML: the Twilio Markup Language</a>.</li>
</ul>
</div><div data-tile="Create a survey" data-file="src/main/java/com/twilio/survey/util/SurveyParser.java" data-highlight="32-74" class="step"><h2 id="create-a-survey">Create a survey</h2>
<p>In order to perform automated surveys we first need to have some
questions to ask. For your convenience, the application&#39;s
repository already includes one survey that can be loaded into
the database. If the database is configured correctly this
survey will be loaded into the database when the app starts.</p>
<p>You can modify the questions from the survey by editing the
<a href="https://github.com/TwilioDevEd/automated-survey-spring/blob/master/survey.json">survey.json</a>
file located in the root of the repository and re-running the app.</p>
<p>We want users to take our survey, so next we are going implement
the handler for SMS and calls.</p>
<p>We want the users to take our survey, so next we are going to look at the code necessary 
to respond to Twilio&#39;s survey request.</p>
</div><div data-tile="The Interview Loop" class="step"><h2 id="the-interview-loop">The Interview Loop</h2>
<p>It is helpful to visualize your interaction with a user during a survey as a loop. The chart below shows how that interaction will be handled. (click it to make it bigger):</p>
<p><img src="//s3.amazonaws.com/howtodocs/flowchart.png" alt="Survey Flow Chart"></p>
<p>The user can enter input for your survey over the phone using either their phone&#39;s keypad or by speaking. After each interaction, Twilio will make an HTTP request to your web application with either the string of keys the user pressed or a URL to a recording of their voice input.</p>
<p>It&#39;s up to the application to process, store and respond to the user&#39;s input.</p>
<p>Let&#39;s dive into this flow to see how it actually works.</p>
</div><div data-file="src/main/java/com/twilio/survey/controllers/SurveyController.java" data-title="Configuring a Twilio Number" data-highlight="24-97" class="step"><h2 id="configuring-a-twilio-number">Configuring a Twilio Number</h2>
<p>To initiate the interview process, we need to configure one of our <a href="/user/account/phone-numbers/incoming">Twilio numbers</a> to send our web application an HTTP request when we get an incoming call or text.</p>
<p><a href="/user/account/phone-numbers/incoming">Click on one of your numbers</a> and configure Voice and Message URLs that point to your server. In our code, the routes are <code>/survey/call</code> and <code>/survey/sms</code>, respectively.</p>
<p><img src="//s3.amazonaws.com/howtodocs/number-config.png" alt="Configuring a Twilio Number"></p>
</div><div data-file="src/main/java/com/twilio/survey/controllers/SurveyController.java" data-title="Responding To A Phone Call" data-highlight="25-41, 81-85" class="step"><h2 id="responding-to-a-phone-call">Responding to a Phone Call</h2>
<p>Right after receiveing a call or a SMS, Twilio will send a request to the url specified on the number config 
(/survey/call for calls and /survey/sms for sms). Each of these endpoints will receive the request and will use a 
<code>TwiMLResponseBuilder</code> to return a welcome message to the user. For phone users, the built message will contain a <code>Say</code> 
verb with the message or a <code>Message</code> Verb for SMS.</p>
<p>It will also include a <code>Redirect</code> verb to the question enpoint, in order to continue the survey flow.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="https://www.twilio.com/platform/webhooks">Twilio webhooks</a></li>
<li><a href="https://www.twilio.com/docs/api/twiml/your_response">TwiML Voice: Your Response</a></li>
<li><a href="https://www.twilio.com/docs/api/twiml/sms/your_response">TwiML SMS: Your Response</a></li>
<li><a href="https://www.twilio.com/docs/api/twiml/say">TwiML Voice: &lt;Say&gt;</a></li>
<li><a href="https://www.twilio.com/docs/api/twiml/sms/message">TwiML SMS: &lt;Message&gt;</a></li>
<li><a href="https://www.twilio.com/docs/api/twiml/redirect">TwiML Voice: &lt;Redirect&gt;</a></li>
<li><a href="https://www.twilio.com/docs/api/twiml/sms/redirect">TwiML SMS: &lt;Redirect&gt;</a></li>
</ul>
</div><div data-file="src/main/java/com/twilio/survey/controllers/QuestionController.java" data-highlight="32-62" class="step"><h2 id="question-controller">Question Controller</h2>
<p>This endpoint will just check if it&#39;s a SMS or Call and instantiate the proper class to build a TwiML response.
Each type of question and interaction (Call/SMS) will produce different instructions on how to proceed.
For instance, we can record voice or gather a key press during a call, but we can&#39;t do the same for text messages.</p>
<p>When the user is interacting over SMS we don&#39;t have something like an ongoing call session with a well defined state.
It becomes harder to know if a SMS is answering question 2 or 20, since all requests will be fired to <code>/survey/sms</code> main endpoint.
To solve that, we will use <a href="https://www.twilio.com/blog/2014/07/the-definitive-guide-to-sms-conversation-tracking.html">Twilio Cookies</a>
to keep the question being answered at the moment. That is done by <code>createSessionForQuestion</code> method.</p>
<p>Let&#39;s see how the response is built.</p>
</div><div data-file="src/main/java/com/twilio/survey/util/TwiMLResponseBuilder.java" data-highlight="54-72" class="step"><h2 id="building-our-twiml-verbs">Building Our TwiML Verbs</h2>
<p>If the question is of kind &quot;numeric&quot; then we use the
<a href="https://www.twilio.com/docs/api/twiml/gather"><code>&lt;Gather&gt;</code></a>
verb. However, if we expect dialpad input we use the the
<a href="https://www.twilio.com/docs/api/twiml/record"><code>&lt;Record&gt;</code></a>
verb. Both verbs take an <code>action</code> attribute and a <code>method</code>
attribute. Twilio&#39;s client will use both attributes to make a
request we can use to store the caller&#39;s answer to the question
on ResponseController endpoint.</p>
<p>During the Record verb creation, we also ask for a <a href="https://www.twilio.com/docs/api/rest/transcription">Transcription</a>.
Twilio will process the record and extract useful text, making a request to our response endpoint when transcription is done.</p>
<h2 id="now-let-s-see-what-to-do-with-the-response-">Now let&#39;s see what to do with the response.</h2>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="https://www.twilio.com/docs/api/twiml/gather">TwiML Voice: &lt;Gather&gt;</a></li>
<li><a href="https://www.twilio.com/docs/api/twiml/record">TwiML Voice: &lt;Record&gt;</a></li>
</ul>
</div><div data-file="src/main/java/com/twilio/survey/controllers/ResponseController.java" data-highlight="38-76" class="step"><h2 id="handling-responses-">Handling responses.</h2>
<p>Ok, user finished speaking and pressing keys and Twilio just sent us a request telling what happened, asking for further instructions.</p>
<p>At this point, we need to recover data from Twilio&#39;s request (<code>ResponseParser</code> does that) parameters and store them on <code>persistResponse</code> method.
Recovered parameters vary according to what we asked during the question, they can be:</p>
<ul>
<li>Body: Contains the text message from answer over SMS.</li>
<li>Digits: Keys pressed for a numeric question.</li>
<li>RecodingUrl: URL for listening a recorded message.</li>
<li>TranscriptionText: Result of a recording transcription.</li>
</ul>
<p>Finally we redirect to our Question controller, which will ask the next question on the loop.
This is done on <code>redirectToNextQuestion</code> method.</p>
<p>Now, let&#39;s see how to visualize the results.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="https://www.twilio.com/docs/api/twiml/your_response">TwiML Voice: Your Response</a></li>
<li><a href="https://www.twilio.com/docs/api/twiml/sms/your_response">TwiML SMS: Your Response</a></li>
</ul>
</div><div data-file="src/main/java/com/twilio/survey/controllers/DisplayController.java" data-highlight="31-53" class="step"><h2 id="display-the-survey-results">Display the survey results</h2>
<p>For this route we simply query the database using a JPA query
and then display the information within a Mustache template. We
display a panel for every question on the last survey, and
inside every panel we list the responses from different calls.</p>
<p>You can access this page in the applications root route <code>/</code>.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="https://mustache.github.io/">Mustache templates</a></li>
</ul>
</div><div class="step"><h2 id="where-to-next-">Where to next?</h2>
<p>It&#39;s done! If you have configured one of your Twilio
numbers to the application built in this tutorial you should be
able to take the survey and see the results under the root route of
the application. We hope you found this sample application
useful.  If you&#39;re a Java developer working with Twilio, you
might enjoy these other tutorials:</p>
<h3 id="-appointment-reminders-https-www-twilio-com-docs-howto-walkthrough-appointment-reminders-java-spark-"><a href="https://www.twilio.com/docs/howto/walkthrough/appointment-reminders/java/spark">Appointment Reminders</a></h3>
<p>Automate the process of reaching out to your customers in advance of an upcoming appointment.</p>
<h3 id="-click-to-call-https-www-twilio-com-docs-tutorials-walkthrough-click-to-call-java-spring-"><a href="https://www.twilio.com/docs/tutorials/walkthrough/click-to-call/java/spring">Click to Call</a></h3>
<p>Click-to-call enables your company to convert web traffic into phone calls with the click of a button.</p>
<h3 id="did-this-help-">Did this help?</h3>
<p>Thanks for checking out this tutorial! If you have any feedback to share with us,
we&#39;d love to hear it. Tweet <a href="twitter.com/twilio">@twilio</a> to let us know what you think.</p>
</div></div>
<div class="saurus-files" style="display:none;"><textarea class="saurus-file" data-file="src/main/java/com/twilio/survey/SurveyJavaApplication.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLnN1cnZleTsKCmltcG9ydCBjb20udHdpbGlvLnN1cnZleS5yZXBvc2l0b3JpZXMuUXVlc3Rpb25SZXBvc2l0b3J5OwppbXBvcnQgY29tLnR3aWxpby5zdXJ2ZXkucmVwb3NpdG9yaWVzLlN1cnZleVJlcG9zaXRvcnk7CmltcG9ydCBjb20udHdpbGlvLnN1cnZleS5zZXJ2aWNlcy5RdWVzdGlvblNlcnZpY2U7CmltcG9ydCBjb20udHdpbGlvLnN1cnZleS5zZXJ2aWNlcy5TdXJ2ZXlTZXJ2aWNlOwppbXBvcnQgY29tLnR3aWxpby5zdXJ2ZXkudXRpbC5TdXJ2ZXlQYXJzZXI7CmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLmJlYW5zLmZhY3RvcnkuYW5ub3RhdGlvbi5BdXRvd2lyZWQ7CmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLmJvb3QuQ29tbWFuZExpbmVSdW5uZXI7CmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLmJvb3QuU3ByaW5nQXBwbGljYXRpb247CmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLmJvb3QuYXV0b2NvbmZpZ3VyZS5TcHJpbmdCb290QXBwbGljYXRpb247CgpAU3ByaW5nQm9vdEFwcGxpY2F0aW9uCnB1YmxpYyBjbGFzcyBTdXJ2ZXlKYXZhQXBwbGljYXRpb24gaW1wbGVtZW50cyBDb21tYW5kTGluZVJ1bm5lciB7CiAgICBAQXV0b3dpcmVkCiAgICBwcml2YXRlIFF1ZXN0aW9uUmVwb3NpdG9yeSBxdWVzdGlvblJlcG9zaXRvcnk7CiAgICBAQXV0b3dpcmVkCiAgICBwcml2YXRlIFN1cnZleVJlcG9zaXRvcnkgc3VydmV5UmVwb3NpdG9yeTsKCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgbWFpbihTdHJpbmdbXSBhcmdzKSB7CiAgICAgICAgU3ByaW5nQXBwbGljYXRpb24ucnVuKFN1cnZleUphdmFBcHBsaWNhdGlvbi5jbGFzcywgYXJncyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBNZXRob2QgdGhhdCBydW5zIG9uIGFwcCBpbml0aWFsaXphdGlvbi4gSXQgd2lsbCBwYXJzZSBhbmQgaW5zZXJ0IHRoZSBxdWVzdGlvbnMgaW4gdGhlIERCCiAgICAgKiBvbiBldmVyeSBhcHAgaW5pdGlhbGl6YXRpb24KICAgICAqLwogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBydW4oU3RyaW5nLi4uIHN0cmluZ3MpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIFN1cnZleVNlcnZpY2Ugc3VydmV5U2VydmljZSA9IG5ldyBTdXJ2ZXlTZXJ2aWNlKHN1cnZleVJlcG9zaXRvcnkpOwogICAgICAgIFF1ZXN0aW9uU2VydmljZSBxdWVzdGlvblNlcnZpY2UgPSBuZXcgUXVlc3Rpb25TZXJ2aWNlKHF1ZXN0aW9uUmVwb3NpdG9yeSk7CgogICAgICAgIFN1cnZleVBhcnNlciBzdXJ2ZXlQYXJzZXIgPSBuZXcgU3VydmV5UGFyc2VyKHN1cnZleVNlcnZpY2UsIHF1ZXN0aW9uU2VydmljZSk7CiAgICAgICAgc3VydmV5UGFyc2VyLnBhcnNlKCJzdXJ2ZXkuanNvbiIpOwogICAgfQp9Cg==</textarea>
<textarea class="saurus-file" data-file="src/main/java/com/twilio/survey/util/SurveyParser.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLnN1cnZleS51dGlsOwoKaW1wb3J0IGNvbS50d2lsaW8uc3VydmV5Lm1vZGVscy5RdWVzdGlvbjsKaW1wb3J0IGNvbS50d2lsaW8uc3VydmV5Lm1vZGVscy5TdXJ2ZXk7CmltcG9ydCBjb20udHdpbGlvLnN1cnZleS5zZXJ2aWNlcy5RdWVzdGlvblNlcnZpY2U7CmltcG9ydCBjb20udHdpbGlvLnN1cnZleS5zZXJ2aWNlcy5TdXJ2ZXlTZXJ2aWNlOwppbXBvcnQgb3JnLmpzb24uc2ltcGxlLkpTT05BcnJheTsKaW1wb3J0IG9yZy5qc29uLnNpbXBsZS5KU09OT2JqZWN0OwppbXBvcnQgb3JnLmpzb24uc2ltcGxlLnBhcnNlci5KU09OUGFyc2VyOwppbXBvcnQgb3JnLmpzb24uc2ltcGxlLnBhcnNlci5QYXJzZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsudHJhbnNhY3Rpb24uYW5ub3RhdGlvbi5UcmFuc2FjdGlvbmFsOwoKaW1wb3J0IGphdmEuaW8uRmlsZU5vdEZvdW5kRXhjZXB0aW9uOwppbXBvcnQgamF2YS5pby5GaWxlUmVhZGVyOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5EYXRlOwoKLyoqCiAqIENsYXNzIGluIGNoYXJnZSBvZiBwYXJzaW5nIHRoZSBKU09OIGZpbGUgdGhhdCBjb250YWlucyB0aGUgbGlzdCBvZiBxdWVzdGlvbnMuCiAqLwpwdWJsaWMgY2xhc3MgU3VydmV5UGFyc2VyIHsKICAgIFN1cnZleVNlcnZpY2Ugc3VydmV5U2VydmljZTsKICAgIFF1ZXN0aW9uU2VydmljZSBxdWVzdGlvblNlcnZpY2U7CgogICAgcHVibGljIFN1cnZleVBhcnNlcigpIHsKICAgIH0KCiAgICBwdWJsaWMgU3VydmV5UGFyc2VyKFN1cnZleVNlcnZpY2Ugc3VydmV5U2VydmljZSwgUXVlc3Rpb25TZXJ2aWNlIHF1ZXN0aW9uU2VydmljZSkgewogICAgICAgIHRoaXMuc3VydmV5U2VydmljZSA9IHN1cnZleVNlcnZpY2U7CiAgICAgICAgdGhpcy5xdWVzdGlvblNlcnZpY2UgPSBxdWVzdGlvblNlcnZpY2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpcyBjYWxsZWQgb24gYXBwIGluaXRpYWxpemF0aW9uLgogICAgICogSXQgd2lsbCBpbnNlcnQgdGhlIHF1ZXN0aW9ucyBpbiB0aGUgREIgZXZlcnkgdGltZSB0aGUgYXBwbGljYXRpb24gc3RhcnRzCiAgICAgKgogICAgICogQHBhcmFtIGZpbGVQYXRoIHBhdGggZm9yIHRoZSAuanNvbiBmaWxlCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHBhcnNlKFN0cmluZyBmaWxlUGF0aCkgewogICAgICAgIEZpbGVSZWFkZXIgcmVhZGVyID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcihmaWxlUGF0aCk7CiAgICAgICAgfSBjYXRjaCAoRmlsZU5vdEZvdW5kRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgZS5wcmludFN0YWNrVHJhY2UoKTsKICAgICAgICB9CiAgICAgICAgSlNPTlBhcnNlciBqc29uUGFyc2VyID0gbmV3IEpTT05QYXJzZXIoKTsKICAgICAgICBKU09OT2JqZWN0IGpzb25PYmplY3QgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGpzb25PYmplY3QgPSAoSlNPTk9iamVjdCkganNvblBhcnNlci5wYXJzZShyZWFkZXIpOwogICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJFcnJvciByZWFkaW5nIGZyb20gc3VydmV5IGZpbGUiKTsKICAgICAgICB9IGNhdGNoIChQYXJzZUV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigiRXJyb3Igd2hpbGUgcGFyc2luZyBKU09OIHN1cnZleSBmaWxlIik7CiAgICAgICAgfQoKICAgICAgICBTdHJpbmcgdGl0bGUgPSAoU3RyaW5nKSBqc29uT2JqZWN0LmdldCgidGl0bGUiKTsKICAgICAgICBKU09OQXJyYXkgcXVlc3Rpb25zID0gKEpTT05BcnJheSkganNvbk9iamVjdC5nZXQoInF1ZXN0aW9ucyIpOwoKICAgICAgICBpbnNlcnRTdXJ2ZXlJbnRvRGIodGl0bGUsIHF1ZXN0aW9ucyk7CiAgICB9CgogICAgQFRyYW5zYWN0aW9uYWwKICAgIHByaXZhdGUgdm9pZCBpbnNlcnRTdXJ2ZXlJbnRvRGIoU3RyaW5nIHRpdGxlLCBKU09OQXJyYXkgcXVlc3Rpb25zKSB7CiAgICAgICAgU3VydmV5IHN1cnZleSA9IG5ldyBTdXJ2ZXkodGl0bGUsIG5ldyBEYXRlKCkpOwogICAgICAgIHN1cnZleVNlcnZpY2UuY3JlYXRlKHN1cnZleSk7CiAgICAgICAgUXVlc3Rpb24gbmV3UXVlc3Rpb247CgogICAgICAgIGZvciAoT2JqZWN0IHF1ZXN0aW9uIDogcXVlc3Rpb25zKSB7CiAgICAgICAgICAgIEpTT05PYmplY3Qgb2JqID0gKEpTT05PYmplY3QpIHF1ZXN0aW9uOwogICAgICAgICAgICBTdHJpbmcgYm9keSA9IChTdHJpbmcpIG9iai5nZXQoImJvZHkiKTsKICAgICAgICAgICAgU3RyaW5nIHR5cGUgPSAoU3RyaW5nKSBvYmouZ2V0KCJ0eXBlIik7CiAgICAgICAgICAgIG5ld1F1ZXN0aW9uID0gbmV3IFF1ZXN0aW9uKGJvZHksIHR5cGUsIHN1cnZleSwgbmV3IERhdGUoKSk7CiAgICAgICAgICAgIHF1ZXN0aW9uU2VydmljZS5zYXZlKG5ld1F1ZXN0aW9uKTsKICAgICAgICB9CiAgICB9Cn0K</textarea>
<textarea class="saurus-file" data-file="src/main/java/com/twilio/survey/controllers/SurveyController.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLnN1cnZleS5jb250cm9sbGVyczsKCmltcG9ydCBjb20udHdpbGlvLnN1cnZleS5tb2RlbHMuU3VydmV5OwppbXBvcnQgY29tLnR3aWxpby5zdXJ2ZXkucmVwb3NpdG9yaWVzLlN1cnZleVJlcG9zaXRvcnk7CmltcG9ydCBjb20udHdpbGlvLnN1cnZleS5zZXJ2aWNlcy5TdXJ2ZXlTZXJ2aWNlOwppbXBvcnQgY29tLnR3aWxpby5zdXJ2ZXkudXRpbC5Ud2lNTFJlc3BvbnNlQnVpbGRlcjsKaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsuYmVhbnMuZmFjdG9yeS5hbm5vdGF0aW9uLkF1dG93aXJlZDsKaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsuc3RlcmVvdHlwZS5Db250cm9sbGVyOwppbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay53ZWIuYmluZC5hbm5vdGF0aW9uLlJlcXVlc3RNYXBwaW5nOwppbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay53ZWIuYmluZC5hbm5vdGF0aW9uLlJlcXVlc3RNZXRob2Q7CgppbXBvcnQgamF2YXguc2VydmxldC5odHRwLkh0dHBTZXJ2bGV0UmVxdWVzdDsKaW1wb3J0IGphdmF4LnNlcnZsZXQuaHR0cC5IdHRwU2VydmxldFJlc3BvbnNlOwppbXBvcnQgamF2YXguc2VydmxldC5odHRwLkh0dHBTZXNzaW9uOwoKQENvbnRyb2xsZXIKcHVibGljIGNsYXNzIFN1cnZleUNvbnRyb2xsZXIgewogICAgQEF1dG93aXJlZAogICAgcHJpdmF0ZSBTdXJ2ZXlSZXBvc2l0b3J5IHN1cnZleVJlcG9zaXRvcnk7CiAgICBwcml2YXRlIFN1cnZleVNlcnZpY2Ugc3VydmV5U2VydmljZTsKCiAgICBwdWJsaWMgU3VydmV5Q29udHJvbGxlcigpIHsKICAgIH0KCiAgICAvKioKICAgICAqIENhbGxzIGVuZHBvaW50OyBXZWxjb21lcyBhIHVzZXIgYW5kIHJlZGlyZWN0cyB0byB0aGUgcXVlc3Rpb24gY29udHJvbGxlciBpZiB0aGVyZSBpcyBhIHN1cnZleSB0byBiZSBhbnN3ZXJlZC4KICAgICAqIE90aGVyd2lzZSBpdCBwbGF5cyBhIG1lc3NhZ2UgYW5kIGhhbmcgdXAgdGhlIGNhbGwgaWYgdGhlcmUgaXMgbm8gc3VydmV5IGF2YWlsYWJsZS4KICAgICAqLwogICAgQFJlcXVlc3RNYXBwaW5nKHZhbHVlID0gIi9zdXJ2ZXkvY2FsbCIsIG1ldGhvZCA9IFJlcXVlc3RNZXRob2QuR0VUKQogICAgcHVibGljIHZvaWQgY2FsbChIdHRwU2VydmxldFJlcXVlc3QgcmVxdWVzdCwgSHR0cFNlcnZsZXRSZXNwb25zZSByZXNwb25zZSkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgdGhpcy5zdXJ2ZXlTZXJ2aWNlID0gbmV3IFN1cnZleVNlcnZpY2Uoc3VydmV5UmVwb3NpdG9yeSk7CgogICAgICAgIFN1cnZleSBsYXN0U3VydmV5ID0gc3VydmV5U2VydmljZS5maW5kTGFzdCgpOwoKICAgICAgICBpZiAobGFzdFN1cnZleSAhPSBudWxsKSB7CiAgICAgICAgICAgIHJlc3BvbnNlLmdldFdyaXRlcigpLnByaW50KGdldEZpcnN0UXVlc3Rpb25SZWRpcmVjdChsYXN0U3VydmV5LCByZXF1ZXN0KSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVzcG9uc2UuZ2V0V3JpdGVyKCkucHJpbnQoZ2V0SGFuZ3VwUmVzcG9uc2UocmVxdWVzdCkpOwogICAgICAgIH0KICAgICAgICByZXNwb25zZS5zZXRDb250ZW50VHlwZSgiYXBwbGljYXRpb24veG1sIik7CiAgICB9CgogICAgLyoqCiAgICAgKiBTTVMgZW5kcG9pbnQ7IFdlbGNvbWVzIGEgdXNlciBhbmQgcmVkaXJlY3RzIHRvIHRoZSBxdWVzdGlvbiBjb250cm9sbGVyIGlmIHRoZXJlIGlzIGEgc3VydmV5IHRvIGJlIGFuc3dlcmVkLgogICAgICogQXMgU01TIGlzIGp1c3QgYSBtZXNzYWdlIGluc3RlYWQgb2YgYSBsb25nIHJ1bm5pbmcgY2FsbCwgd2Ugc3RvcmUgc3RhdGUgYnkgbWFwcGluZyBhIFR3aWxpbydzIENvb2tpZSB0byBhIFNlc3Npb24KICAgICAqLwogICAgQFJlcXVlc3RNYXBwaW5nKHZhbHVlID0gIi9zdXJ2ZXkvc21zIiwgbWV0aG9kID0gUmVxdWVzdE1ldGhvZC5HRVQpCiAgICBwdWJsaWMgdm9pZCBzbXMoSHR0cFNlcnZsZXRSZXF1ZXN0IHJlcXVlc3QsIEh0dHBTZXJ2bGV0UmVzcG9uc2UgcmVzcG9uc2UpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIHRoaXMuc3VydmV5U2VydmljZSA9IG5ldyBTdXJ2ZXlTZXJ2aWNlKHN1cnZleVJlcG9zaXRvcnkpOwoKICAgICAgICBTdXJ2ZXkgbGFzdFN1cnZleSA9IHN1cnZleVNlcnZpY2UuZmluZExhc3QoKTsKICAgICAgICBIdHRwU2Vzc2lvbiBzZXNzaW9uID0gcmVxdWVzdC5nZXRTZXNzaW9uKGZhbHNlKTsKCiAgICAgICAgaWYgKGxhc3RTdXJ2ZXkgIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoc2Vzc2lvbiA9PSBudWxsIHx8IHNlc3Npb24uaXNOZXcoKSkgewogICAgICAgICAgICAgICAgLy8gTmV3IHNlc3Npb24sCiAgICAgICAgICAgICAgICByZXNwb25zZS5nZXRXcml0ZXIoKS5wcmludChnZXRGaXJzdFF1ZXN0aW9uUmVkaXJlY3QobGFzdFN1cnZleSwgcmVxdWVzdCkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gT25nb2luZyBzZXNzaW9uLCByZWRpcmVjdCB0byBSZXNwb25zZUNvbnRyb2xsZXIgdG8gc2F2ZSBpdCdzIGFuc3dlci4KICAgICAgICAgICAgICAgIHJlc3BvbnNlLmdldFdyaXRlcigpLnByaW50KGdldFNhdmVSZXNwb25zZVJlZGlyZWN0KHNlc3Npb24pKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIE5vIHN1cnZleQogICAgICAgICAgICByZXNwb25zZS5nZXRXcml0ZXIoKS5wcmludChnZXRIYW5ndXBSZXNwb25zZShyZXF1ZXN0KSk7CiAgICAgICAgfQogICAgICAgIHJlc3BvbnNlLnNldENvbnRlbnRUeXBlKCJhcHBsaWNhdGlvbi94bWwiKTsKICAgIH0KCiAgICBwcml2YXRlIFN0cmluZyBnZXRTYXZlUmVzcG9uc2VSZWRpcmVjdChIdHRwU2Vzc2lvbiBzZXNzaW9uKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBTdHJpbmcgc2F2ZVVSTCA9ICIvc2F2ZV9yZXNwb25zZT9xaWQ9IiArIGdldFF1ZXN0aW9uSWRGcm9tU2Vzc2lvbihzZXNzaW9uKTsKICAgICAgICByZXR1cm4gbmV3IFR3aU1MUmVzcG9uc2VCdWlsZGVyKCkucmVkaXJlY3RQT1NUKHNhdmVVUkwpLmFzU3RyaW5nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGVzIHRoZSBUd2lNTFJlc3BvbnNlIGZvciB0aGUgZmlyc3QgcXVlc3Rpb24gb2YgdGhlIHN1cnZleQogICAgICoKICAgICAqIEBwYXJhbSBzdXJ2ZXkgIFN1cnZleSBlbnRpdHkKICAgICAqIEBwYXJhbSByZXF1ZXN0IEh0dHBTZXJ2bGV0UmVxdWVzdCByZXF1ZXN0CiAgICAgKiBAcmV0dXJuIFR3aU1MUmVzcG9uc2UKICAgICAqLwogICAgcHJpdmF0ZSBTdHJpbmcgZ2V0Rmlyc3RRdWVzdGlvblJlZGlyZWN0KFN1cnZleSBzdXJ2ZXksIEh0dHBTZXJ2bGV0UmVxdWVzdCByZXF1ZXN0KSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBTdHJpbmcgd2VsY29tZU1lc3NhZ2UgPSAiV2VsY29tZSB0byB0aGUgIiArIHN1cnZleS5nZXRUaXRsZSgpICsgIiBzdXJ2ZXkiOwogICAgICAgIFN0cmluZyBxdWVzdGlvblVSTCA9ICIvcXVlc3Rpb24/c3VydmV5PSIgKyBzdXJ2ZXkuZ2V0SWQoKSArICImcXVlc3Rpb249MSI7CiAgICAgICAgcmV0dXJuIG5ldyBUd2lNTFJlc3BvbnNlQnVpbGRlcigpLndyaXRlQ29udGVudChyZXF1ZXN0LCB3ZWxjb21lTWVzc2FnZSkucmVkaXJlY3QocXVlc3Rpb25VUkwpLmFzU3RyaW5nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGVzIGEgVHdpTUxSZXNwb25zZSBpZiBubyBzdXJ2ZXlzIGFyZSBmb3VuZCBvbiB0aGUgZGF0YWJhc2UKICAgICAqIEZvciBTTVMsIGl0J3MganVzdCBhIG1lc3NhZ2UKICAgICAqIEZvciBWb2ljZSBpdCBzaG91bGQgYWxzbyBzZW5kIGEgSGFuZ3VwIHRvIHRoZSBvbmdvaW5nIGNhbGwKICAgICAqCiAgICAgKiBAcmV0dXJuIFR3aU1MUmVzcG9uc2UKICAgICAqLwogICAgcHJpdmF0ZSBTdHJpbmcgZ2V0SGFuZ3VwUmVzcG9uc2UoSHR0cFNlcnZsZXRSZXF1ZXN0IHJlcXVlc3QpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIFN0cmluZyBlcnJvck1lc3NhZ2UgPSAiV2UgYXJlIHNvcnJ5LCB0aGVyZSBhcmUgbm8gc3VydmV5cyBhdmFpbGFibGUuIEdvb2QgYnllLiI7CiAgICAgICAgY2xlYW5TZXNzaW9uKHJlcXVlc3QpOwogICAgICAgIHJldHVybiBuZXcgVHdpTUxSZXNwb25zZUJ1aWxkZXIoKS53cml0ZUNvbnRlbnQocmVxdWVzdCwgZXJyb3JNZXNzYWdlLCB0cnVlKS5hc1N0cmluZygpOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBjbGVhblNlc3Npb24oSHR0cFNlcnZsZXRSZXF1ZXN0IHJlcXVlc3QpIHsKICAgICAgICBIdHRwU2Vzc2lvbiBzZXNzaW9uID0gcmVxdWVzdC5nZXRTZXNzaW9uKGZhbHNlKTsKICAgICAgICBpZiAoc2Vzc2lvbiAhPSBudWxsKSB7CiAgICAgICAgICAgIHNlc3Npb24uaW52YWxpZGF0ZSgpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIExvbmcgZ2V0UXVlc3Rpb25JZEZyb21TZXNzaW9uKEh0dHBTZXNzaW9uIHNlc3Npb24pIHsKICAgICAgICByZXR1cm4gKExvbmcpIHNlc3Npb24uZ2V0QXR0cmlidXRlKCJxdWVzdGlvbklkIik7CiAgICB9Cn0K</textarea>
<textarea class="saurus-file" data-file="src/main/java/com/twilio/survey/controllers/QuestionController.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLnN1cnZleS5jb250cm9sbGVyczsKCmltcG9ydCBjb20udHdpbGlvLnN1cnZleS5tb2RlbHMuUXVlc3Rpb247CmltcG9ydCBjb20udHdpbGlvLnN1cnZleS5tb2RlbHMuU3VydmV5OwppbXBvcnQgY29tLnR3aWxpby5zdXJ2ZXkucmVwb3NpdG9yaWVzLlN1cnZleVJlcG9zaXRvcnk7CmltcG9ydCBjb20udHdpbGlvLnN1cnZleS5zZXJ2aWNlcy5TdXJ2ZXlTZXJ2aWNlOwppbXBvcnQgY29tLnR3aWxpby5zdXJ2ZXkudXRpbC5RdWVzdGlvbkJ1aWxkZXI7CmltcG9ydCBjb20udHdpbGlvLnN1cnZleS51dGlsLlNNU1F1ZXN0aW9uQnVpbGRlcjsKaW1wb3J0IGNvbS50d2lsaW8uc3VydmV5LnV0aWwuVm9pY2VRdWVzdGlvbkJ1aWxkZXI7CmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLmJlYW5zLmZhY3RvcnkuYW5ub3RhdGlvbi5BdXRvd2lyZWQ7CmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLnN0ZXJlb3R5cGUuQ29udHJvbGxlcjsKaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsud2ViLmJpbmQuYW5ub3RhdGlvbi5SZXF1ZXN0TWFwcGluZzsKaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsud2ViLmJpbmQuYW5ub3RhdGlvbi5SZXF1ZXN0TWV0aG9kOwoKaW1wb3J0IGphdmF4LnNlcnZsZXQuaHR0cC5IdHRwU2VydmxldFJlcXVlc3Q7CmltcG9ydCBqYXZheC5zZXJ2bGV0Lmh0dHAuSHR0cFNlcnZsZXRSZXNwb25zZTsKaW1wb3J0IGphdmF4LnNlcnZsZXQuaHR0cC5IdHRwU2Vzc2lvbjsKCkBDb250cm9sbGVyCnB1YmxpYyBjbGFzcyBRdWVzdGlvbkNvbnRyb2xsZXIgewogICAgQEF1dG93aXJlZAogICAgcHJpdmF0ZSBTdXJ2ZXlSZXBvc2l0b3J5IHN1cnZleVJlcG9zaXRvcnk7CiAgICBwcml2YXRlIFN1cnZleVNlcnZpY2Ugc3VydmV5U2VydmljZTsKCiAgICBwdWJsaWMgUXVlc3Rpb25Db250cm9sbGVyKCkgewogICAgfQoKICAgIC8qKgogICAgICogRW5kIHBvaW50IHRoYXQgcmV0dXJucyB0aGUgYXBwcm9wcmlhdGUgcXVlc3Rpb24gcmVzcG9uc2UgYmFzZWQgb24gdGhlIHBhcmFtZXRlcnMgaXQgcmVjZWl2ZXMKICAgICAqLwogICAgQFJlcXVlc3RNYXBwaW5nKHZhbHVlID0gIi9xdWVzdGlvbiIsIG1ldGhvZCA9IFJlcXVlc3RNZXRob2QuR0VUKQogICAgcHVibGljIHZvaWQgc2hvdyhIdHRwU2VydmxldFJlcXVlc3QgcmVxdWVzdCwgSHR0cFNlcnZsZXRSZXNwb25zZSByZXNwb25zZSkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgdGhpcy5zdXJ2ZXlTZXJ2aWNlID0gbmV3IFN1cnZleVNlcnZpY2Uoc3VydmV5UmVwb3NpdG9yeSk7CiAgICAgICAgU3VydmV5IHN1cnZleSA9IHN1cnZleVNlcnZpY2UuZmluZChMb25nLnBhcnNlTG9uZyhyZXF1ZXN0LmdldFBhcmFtZXRlcigic3VydmV5IikpKTsKCiAgICAgICAgUXVlc3Rpb24gY3VycmVudFF1ZXN0aW9uID0gc3VydmV5LmdldFF1ZXN0aW9uQnlOdW1iZXIoSW50ZWdlci5wYXJzZUludChyZXF1ZXN0LmdldFBhcmFtZXRlcigicXVlc3Rpb24iKSkpOwogICAgICAgIFF1ZXN0aW9uQnVpbGRlciBidWlsZGVyID0gZ2V0UXVlc3Rpb25IYW5kbGVyKGN1cnJlbnRRdWVzdGlvbiwgcmVxdWVzdCk7CgogICAgICAgIGlmIChjdXJyZW50UXVlc3Rpb24gIT0gbnVsbCkgewogICAgICAgICAgICByZXNwb25zZS5nZXRXcml0ZXIoKS5wcmludChidWlsZGVyLmJ1aWxkKCkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlc3BvbnNlLmdldFdyaXRlcigpLnByaW50KGJ1aWxkZXIuYnVpbGROb01vcmVRdWVzdGlvbnMoKSk7CiAgICAgICAgfQogICAgICAgIHJlc3BvbnNlLnNldENvbnRlbnRUeXBlKCJhcHBsaWNhdGlvbi94bWwiKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgY3JlYXRlU2Vzc2lvbkZvclF1ZXN0aW9uKEh0dHBTZXJ2bGV0UmVxdWVzdCByZXF1ZXN0LCBRdWVzdGlvbiBjdXJyZW50UXVlc3Rpb24pIHsKICAgICAgICBpZiAoY3VycmVudFF1ZXN0aW9uID09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBIdHRwU2Vzc2lvbiBzZXNzaW9uID0gcmVxdWVzdC5nZXRTZXNzaW9uKHRydWUpOwogICAgICAgIHNlc3Npb24uc2V0QXR0cmlidXRlKCJxdWVzdGlvbklkIiwgY3VycmVudFF1ZXN0aW9uLmdldElkKCkpOwogICAgfQoKICAgIHByaXZhdGUgUXVlc3Rpb25CdWlsZGVyIGdldFF1ZXN0aW9uSGFuZGxlcihRdWVzdGlvbiBjdXJyZW50UXVlc3Rpb24sIEh0dHBTZXJ2bGV0UmVxdWVzdCByZXF1ZXN0KSB7CiAgICAgICAgaWYgKGlzVm9pY2VSZXF1ZXN0KHJlcXVlc3QpKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgVm9pY2VRdWVzdGlvbkJ1aWxkZXIoY3VycmVudFF1ZXN0aW9uKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjcmVhdGVTZXNzaW9uRm9yUXVlc3Rpb24ocmVxdWVzdCwgY3VycmVudFF1ZXN0aW9uKTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBTTVNRdWVzdGlvbkJ1aWxkZXIoY3VycmVudFF1ZXN0aW9uKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBib29sZWFuIGlzVm9pY2VSZXF1ZXN0KEh0dHBTZXJ2bGV0UmVxdWVzdCByZXF1ZXN0KSB7CiAgICAgICAgcmV0dXJuIHJlcXVlc3QuZ2V0UGFyYW1ldGVyKCJNZXNzYWdlU2lkIikgPT0gbnVsbDsKICAgIH0KfQo=</textarea>
<textarea class="saurus-file" data-file="src/main/java/com/twilio/survey/util/TwiMLResponseBuilder.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLnN1cnZleS51dGlsOwoKaW1wb3J0IGNvbS50d2lsaW8uc2RrLnZlcmJzLio7CmltcG9ydCBjb20udHdpbGlvLnN1cnZleS5tb2RlbHMuUXVlc3Rpb247CgppbXBvcnQgamF2YXguc2VydmxldC5odHRwLkh0dHBTZXJ2bGV0UmVxdWVzdDsKCi8qKgogKiBUd2lNTCBCdWlsZGVyCiAqLwpwdWJsaWMgY2xhc3MgVHdpTUxSZXNwb25zZUJ1aWxkZXIgewogICAgcHJpdmF0ZSBUd2lNTFJlc3BvbnNlIHJlc3BvbnNlOwoKICAgIHB1YmxpYyBUd2lNTFJlc3BvbnNlQnVpbGRlcigpIHsKICAgICAgICByZXNwb25zZSA9IG5ldyBUd2lNTFJlc3BvbnNlKCk7CiAgICB9CgogICAgcHVibGljIFR3aU1MUmVzcG9uc2VCdWlsZGVyIG1lc3NhZ2UoU3RyaW5nIGNvbnRlbnQpIHRocm93cyBUd2lNTEV4Y2VwdGlvbiB7CiAgICAgICAgcmVzcG9uc2UuYXBwZW5kKG5ldyBNZXNzYWdlKGNvbnRlbnQpKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBwdWJsaWMgVHdpTUxSZXNwb25zZUJ1aWxkZXIgc2F5KFN0cmluZyBjb250ZW50KSB0aHJvd3MgVHdpTUxFeGNlcHRpb24gewogICAgICAgIHJlc3BvbnNlLmFwcGVuZChuZXcgU2F5KGNvbnRlbnQpKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBwdWJsaWMgVHdpTUxSZXNwb25zZUJ1aWxkZXIgd3JpdGVDb250ZW50KEh0dHBTZXJ2bGV0UmVxdWVzdCByZXF1ZXN0LCBTdHJpbmcgY29udGVudCkgdGhyb3dzIFR3aU1MRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gd3JpdGVDb250ZW50KHJlcXVlc3QsIGNvbnRlbnQsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgVHdpTUxSZXNwb25zZUJ1aWxkZXIgd3JpdGVDb250ZW50KEh0dHBTZXJ2bGV0UmVxdWVzdCByZXF1ZXN0LCBTdHJpbmcgY29udGVudCwgYm9vbGVhbiBoYW5ndXApIHRocm93cyBUd2lNTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHJlcXVlc3QuZ2V0UGFyYW1ldGVyKCJNZXNzYWdlU2lkIikgIT0gbnVsbCkgewogICAgICAgICAgICBtZXNzYWdlKGNvbnRlbnQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHNheShjb250ZW50KTsKICAgICAgICAgICAgaWYgKGhhbmd1cCkgewogICAgICAgICAgICAgICAgaGFuZ3VwKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVibGljIFR3aU1MUmVzcG9uc2VCdWlsZGVyIGhhbmd1cCgpIHRocm93cyBUd2lNTEV4Y2VwdGlvbiB7CiAgICAgICAgcmVzcG9uc2UuYXBwZW5kKG5ldyBIYW5ndXAoKSk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVibGljIFR3aU1MUmVzcG9uc2VCdWlsZGVyIHBhdXNlKCkgdGhyb3dzIFR3aU1MRXhjZXB0aW9uIHsKICAgICAgICByZXNwb25zZS5hcHBlbmQobmV3IFBhdXNlKCkpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBUd2lNTFJlc3BvbnNlQnVpbGRlciByZWNvcmQoUXVlc3Rpb24gcXVlc3Rpb24pIHRocm93cyBUd2lNTEV4Y2VwdGlvbiB7CiAgICAgICAgUmVjb3JkIHJlY29yZCA9IG5ldyBSZWNvcmQoKTsKICAgICAgICByZWNvcmQuc2V0QWN0aW9uKCIvc2F2ZV9yZXNwb25zZT9xaWQ9IiArIHF1ZXN0aW9uLmdldElkKCkpOwogICAgICAgIHJlY29yZC5zZXRNZXRob2QoIlBPU1QiKTsKICAgICAgICByZWNvcmQuc2V0VHJhbnNjcmliZSh0cnVlKTsKICAgICAgICByZWNvcmQuc2V0VHJhbnNjcmliZUNhbGxiYWNrKCIvc2F2ZV9yZXNwb25zZT9xaWQ9IiArIHF1ZXN0aW9uLmdldElkKCkpOwogICAgICAgIHJlY29yZC5zZXRNYXhMZW5ndGgoNjApOwogICAgICAgIHJlc3BvbnNlLmFwcGVuZChyZWNvcmQpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBUd2lNTFJlc3BvbnNlQnVpbGRlciBnYXRoZXIoUXVlc3Rpb24gcXVlc3Rpb24pIHRocm93cyBUd2lNTEV4Y2VwdGlvbiB7CiAgICAgICAgR2F0aGVyIGdhdGhlciA9IG5ldyBHYXRoZXIoKTsKICAgICAgICBnYXRoZXIuc2V0QWN0aW9uKCIvc2F2ZV9yZXNwb25zZT9xaWQ9IiArIHF1ZXN0aW9uLmdldElkKCkpOwogICAgICAgIGdhdGhlci5zZXRNZXRob2QoIlBPU1QiKTsKICAgICAgICBnYXRoZXIuc2V0RmluaXNoT25LZXkoIiMiKTsKICAgICAgICByZXNwb25zZS5hcHBlbmQoZ2F0aGVyKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBwdWJsaWMgVHdpTUxSZXNwb25zZUJ1aWxkZXIgcmVkaXJlY3QoU3RyaW5nIHVybCkgdGhyb3dzIFR3aU1MRXhjZXB0aW9uIHsKICAgICAgICBSZWRpcmVjdCByZWRpcmVjdCA9IG5ldyBSZWRpcmVjdCh1cmwpOwogICAgICAgIHJlZGlyZWN0LnNldE1ldGhvZCgiR0VUIik7CiAgICAgICAgcmVzcG9uc2UuYXBwZW5kKHJlZGlyZWN0KTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBwdWJsaWMgVHdpTUxSZXNwb25zZUJ1aWxkZXIgcmVkaXJlY3RQT1NUKFN0cmluZyB1cmwpIHRocm93cyBUd2lNTEV4Y2VwdGlvbiB7CiAgICAgICAgUmVkaXJlY3QgcmVkaXJlY3QgPSBuZXcgUmVkaXJlY3QodXJsKTsKICAgICAgICByZWRpcmVjdC5zZXRNZXRob2QoIlBPU1QiKTsKICAgICAgICByZXNwb25zZS5hcHBlbmQocmVkaXJlY3QpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgYXNTdHJpbmcoKSB7CiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnRvRXNjYXBlZFhNTCgpOwogICAgfQoKfQo=</textarea>
<textarea class="saurus-file" data-file="src/main/java/com/twilio/survey/controllers/ResponseController.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLnN1cnZleS5jb250cm9sbGVyczsKCmltcG9ydCBjb20udHdpbGlvLnNkay52ZXJicy5Ud2lNTEV4Y2VwdGlvbjsKaW1wb3J0IGNvbS50d2lsaW8uc3VydmV5Lm1vZGVscy5RdWVzdGlvbjsKaW1wb3J0IGNvbS50d2lsaW8uc3VydmV5Lm1vZGVscy5SZXNwb25zZTsKaW1wb3J0IGNvbS50d2lsaW8uc3VydmV5Lm1vZGVscy5TdXJ2ZXk7CmltcG9ydCBjb20udHdpbGlvLnN1cnZleS5yZXBvc2l0b3JpZXMuUXVlc3Rpb25SZXBvc2l0b3J5OwppbXBvcnQgY29tLnR3aWxpby5zdXJ2ZXkucmVwb3NpdG9yaWVzLlJlc3BvbnNlUmVwb3NpdG9yeTsKaW1wb3J0IGNvbS50d2lsaW8uc3VydmV5LnNlcnZpY2VzLlF1ZXN0aW9uU2VydmljZTsKaW1wb3J0IGNvbS50d2lsaW8uc3VydmV5LnNlcnZpY2VzLlJlc3BvbnNlU2VydmljZTsKaW1wb3J0IGNvbS50d2lsaW8uc3VydmV5LnV0aWwuUmVzcG9uc2VQYXJzZXI7CmltcG9ydCBjb20udHdpbGlvLnN1cnZleS51dGlsLlR3aU1MUmVzcG9uc2VCdWlsZGVyOwppbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5iZWFucy5mYWN0b3J5LmFubm90YXRpb24uQXV0b3dpcmVkOwppbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay5zdGVyZW90eXBlLkNvbnRyb2xsZXI7CmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLndlYi5iaW5kLmFubm90YXRpb24uUmVxdWVzdE1hcHBpbmc7CmltcG9ydCBvcmcuc3ByaW5nZnJhbWV3b3JrLndlYi5iaW5kLmFubm90YXRpb24uUmVxdWVzdE1ldGhvZDsKCmltcG9ydCBqYXZheC5zZXJ2bGV0Lmh0dHAuSHR0cFNlcnZsZXRSZXF1ZXN0OwppbXBvcnQgamF2YXguc2VydmxldC5odHRwLkh0dHBTZXJ2bGV0UmVzcG9uc2U7CmltcG9ydCBqYXZhLmlvLlByaW50V3JpdGVyOwoKQENvbnRyb2xsZXIKcHVibGljIGNsYXNzIFJlc3BvbnNlQ29udHJvbGxlciB7CiAgICBAQXV0b3dpcmVkCiAgICBwcml2YXRlIFF1ZXN0aW9uUmVwb3NpdG9yeSBxdWVzdGlvblJlcG9zaXRvcnk7CiAgICBwcml2YXRlIFF1ZXN0aW9uU2VydmljZSBxdWVzdGlvblNlcnZpY2U7CiAgICBAQXV0b3dpcmVkCiAgICBwcml2YXRlIFJlc3BvbnNlUmVwb3NpdG9yeSByZXNwb25zZVJlcG9zaXRvcnk7CiAgICBwcml2YXRlIFJlc3BvbnNlU2VydmljZSByZXNwb25zZVNlcnZpY2U7CgogICAgcHVibGljIFJlc3BvbnNlQ29udHJvbGxlcigpIHsKICAgIH0KCiAgICAvKioKICAgICAqIEVuZCBwb2ludCB0aGF0IHNhdmVzIGEgcXVlc3Rpb24gcmVzcG9uc2UgYW5kIHJlZGlyZWN0cyB0aGUgY2FsbCB0byB0aGUgbmV4dCBxdWVzdGlvbiwKICAgICAqIGlmIG9uZSBpcyBhdmFpbGFibGUuCiAgICAgKi8KICAgIEBSZXF1ZXN0TWFwcGluZyh2YWx1ZSA9ICIvc2F2ZV9yZXNwb25zZSIsIG1ldGhvZCA9IFJlcXVlc3RNZXRob2QuUE9TVCkKICAgIHB1YmxpYyB2b2lkIHNhdmUoSHR0cFNlcnZsZXRSZXF1ZXN0IHJlcXVlc3QsIEh0dHBTZXJ2bGV0UmVzcG9uc2UgcmVzcG9uc2UpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIFByaW50V3JpdGVyIHJlc3BvbnNlV3JpdGVyID0gcmVzcG9uc2UuZ2V0V3JpdGVyKCk7CiAgICAgICAgdGhpcy5xdWVzdGlvblNlcnZpY2UgPSBuZXcgUXVlc3Rpb25TZXJ2aWNlKHF1ZXN0aW9uUmVwb3NpdG9yeSk7CiAgICAgICAgdGhpcy5yZXNwb25zZVNlcnZpY2UgPSBuZXcgUmVzcG9uc2VTZXJ2aWNlKHJlc3BvbnNlUmVwb3NpdG9yeSk7CgogICAgICAgIFF1ZXN0aW9uIGN1cnJlbnRRdWVzdGlvbiA9IGdldFF1ZXN0aW9uRnJvbVJlcXVlc3QocmVxdWVzdCk7CiAgICAgICAgU3VydmV5IHN1cnZleSA9IGN1cnJlbnRRdWVzdGlvbi5nZXRTdXJ2ZXkoKTsKICAgICAgICBwZXJzaXN0UmVzcG9uc2UobmV3IFJlc3BvbnNlUGFyc2VyKGN1cnJlbnRRdWVzdGlvbiwgcmVxdWVzdCkucGFyc2UoKSk7CgogICAgICAgIGlmIChzdXJ2ZXkuaXNMYXN0UXVlc3Rpb24oY3VycmVudFF1ZXN0aW9uKSkgewogICAgICAgICAgICBTdHJpbmcgbWVzc2FnZSA9ICJUYW5rIHlvdSBmb3IgdGFraW5nIHRoZSAiICsgc3VydmV5LmdldFRpdGxlKCkgKyAiIHN1cnZleS4gR29vZCBCeWUiOwogICAgICAgICAgICByZXNwb25zZVdyaXRlci5wcmludChuZXcgVHdpTUxSZXNwb25zZUJ1aWxkZXIoKS53cml0ZUNvbnRlbnQocmVxdWVzdCwgbWVzc2FnZSwgdHJ1ZSkuYXNTdHJpbmcoKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVzcG9uc2VXcml0ZXIucHJpbnQocmVkaXJlY3RUb05leHRRdWVzdGlvbihzdXJ2ZXkuZ2V0TmV4dFF1ZXN0aW9uTnVtYmVyKGN1cnJlbnRRdWVzdGlvbiksIHN1cnZleSkpOwogICAgICAgIH0KICAgICAgICByZXNwb25zZS5zZXRDb250ZW50VHlwZSgiYXBwbGljYXRpb24veG1sIik7CiAgICB9CgogICAgcHJpdmF0ZSBTdHJpbmcgcmVkaXJlY3RUb05leHRRdWVzdGlvbihpbnQgbmV4dFF1ZXN0aW9uTnVtYmVyLCBTdXJ2ZXkgc3VydmV5KSB0aHJvd3MgVHdpTUxFeGNlcHRpb24gewogICAgICAgIFN0cmluZyBuZXh0UXVlc3Rpb25VUkwgPSAiL3F1ZXN0aW9uP3N1cnZleT0iICsgc3VydmV5LmdldElkKCkgKyAiJnF1ZXN0aW9uPSIgKyBuZXh0UXVlc3Rpb25OdW1iZXI7CiAgICAgICAgcmV0dXJuIG5ldyBUd2lNTFJlc3BvbnNlQnVpbGRlcigpLnJlZGlyZWN0KG5leHRRdWVzdGlvblVSTCkuYXNTdHJpbmcoKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgcGVyc2lzdFJlc3BvbnNlKFJlc3BvbnNlIHF1ZXN0aW9uUmVzcG9uc2UpIHsKICAgICAgICBRdWVzdGlvbiBjdXJyZW50UXVlc3Rpb24gPSBxdWVzdGlvblJlc3BvbnNlLmdldFF1ZXN0aW9uKCk7CiAgICAgICAgUmVzcG9uc2UgcHJldmlvdXNSZXNwb25zZSA9IHJlc3BvbnNlU2VydmljZS5nZXRCeVNlc3Npb25TaWRBbmRRdWVzdGlvbihxdWVzdGlvblJlc3BvbnNlLmdldFNlc3Npb25TaWQoKSwgY3VycmVudFF1ZXN0aW9uKTsKICAgICAgICBpZiAocHJldmlvdXNSZXNwb25zZSAhPSBudWxsKSB7CiAgICAgICAgICAgIC8vIGl0J3MgYWxyZWFkeSBhbnN3ZXJlZC4gVGhhdCdzIGFuIHVwZGF0ZSBmcm9tIFR3aWxpbyBBUEkgKFRyYW5zY3JpcHRpb25zLCBmb3IgaW5zdGFuY2UpCiAgICAgICAgICAgIHF1ZXN0aW9uUmVzcG9uc2Uuc2V0SWQocHJldmlvdXNSZXNwb25zZS5nZXRJZCgpKTsKICAgICAgICB9CgogICAgICAgIC8qKiBjcmVhdGVzIHRoZSBxdWVzdGlvbiByZXNwb25zZSBvbiB0aGUgZGIgKi8KICAgICAgICByZXNwb25zZVNlcnZpY2Uuc2F2ZShxdWVzdGlvblJlc3BvbnNlKTsKICAgIH0KCiAgICBwcml2YXRlIFF1ZXN0aW9uIGdldFF1ZXN0aW9uRnJvbVJlcXVlc3QoSHR0cFNlcnZsZXRSZXF1ZXN0IHJlcXVlc3QpIHsKICAgICAgICByZXR1cm4gcXVlc3Rpb25TZXJ2aWNlLmZpbmQoTG9uZy5wYXJzZUxvbmcocmVxdWVzdC5nZXRQYXJhbWV0ZXIoInFpZCIpKSk7CiAgICB9Cn0K</textarea>
<textarea class="saurus-file" data-file="src/main/java/com/twilio/survey/controllers/DisplayController.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLnN1cnZleS5jb250cm9sbGVyczsKCmltcG9ydCBjb20udHdpbGlvLnN1cnZleS5tb2RlbHMuUXVlc3Rpb247CmltcG9ydCBjb20udHdpbGlvLnN1cnZleS5tb2RlbHMuU3VydmV5OwppbXBvcnQgY29tLnR3aWxpby5zdXJ2ZXkucmVwb3NpdG9yaWVzLlJlc3BvbnNlUmVwb3NpdG9yeTsKaW1wb3J0IGNvbS50d2lsaW8uc3VydmV5LnJlcG9zaXRvcmllcy5TdXJ2ZXlSZXBvc2l0b3J5OwppbXBvcnQgY29tLnR3aWxpby5zdXJ2ZXkuc2VydmljZXMuUmVzcG9uc2VTZXJ2aWNlOwppbXBvcnQgY29tLnR3aWxpby5zdXJ2ZXkuc2VydmljZXMuU3VydmV5U2VydmljZTsKaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsuYmVhbnMuZmFjdG9yeS5hbm5vdGF0aW9uLkF1dG93aXJlZDsKaW1wb3J0IG9yZy5zcHJpbmdmcmFtZXdvcmsuc3RlcmVvdHlwZS5Db250cm9sbGVyOwppbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay53ZWIuYmluZC5hbm5vdGF0aW9uLlJlcXVlc3RNYXBwaW5nOwppbXBvcnQgb3JnLnNwcmluZ2ZyYW1ld29yay53ZWIuYmluZC5hbm5vdGF0aW9uLlJlcXVlc3RNZXRob2Q7CgppbXBvcnQgamF2YXguc2VydmxldC5odHRwLkh0dHBTZXJ2bGV0UmVxdWVzdDsKaW1wb3J0IGphdmF4LnNlcnZsZXQuaHR0cC5IdHRwU2VydmxldFJlc3BvbnNlOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwoKQENvbnRyb2xsZXIKcHVibGljIGNsYXNzIERpc3BsYXlDb250cm9sbGVyIHsKICAgIEBBdXRvd2lyZWQKICAgIHByaXZhdGUgU3VydmV5UmVwb3NpdG9yeSBzdXJ2ZXlSZXBvc2l0b3J5OwogICAgcHJpdmF0ZSBTdXJ2ZXlTZXJ2aWNlIHN1cnZleVNlcnZpY2U7CiAgICBAQXV0b3dpcmVkCiAgICBwcml2YXRlIFJlc3BvbnNlUmVwb3NpdG9yeSByZXNwb25zZVJlcG9zaXRvcnk7CiAgICBwcml2YXRlIFJlc3BvbnNlU2VydmljZSByZXNwb25zZVNlcnZpY2U7CgogICAgcHVibGljIERpc3BsYXlDb250cm9sbGVyKCkgewogICAgfQoKICAgIC8qKgogICAgICogUmVuZGVycyB0aGUgc3VydmV5IHJlc3VsdHMKICAgICAqCiAgICAgKiBAcGFyYW0gbW9kZWwgICAgRW1wdHkgbW9kZWwgd2hlcmUgeW91IGZpbGwgaW4gdGhlIGRhdGEgdGhhdCB0aGUgdGVtcGxhdGUgd2lsbCB1c2UKICAgICAqIEBwYXJhbSByZXF1ZXN0ICBTdGFuZGFyZCBIdHRwU2VydmxldFJlcXVlc3QgcmVxdWVzdAogICAgICogQHBhcmFtIHJlc3BvbnNlIFN0YW5kYXJkIEh0dHBTZXJ2bGV0UmVzcG9uc2UgcmVzcG9uc2UKICAgICAqIEByZXR1cm4gcmV0dXJucyB0aGUgdGVtcGxhdGUncyBuYW1lCiAgICAgKi8KICAgIEBSZXF1ZXN0TWFwcGluZyh2YWx1ZSA9ICIvIiwgbWV0aG9kID0gUmVxdWVzdE1ldGhvZC5HRVQpCiAgICBwdWJsaWMgU3RyaW5nIGluZGV4KE1hcDxTdHJpbmcsIE9iamVjdD4gbW9kZWwsIEh0dHBTZXJ2bGV0UmVxdWVzdCByZXF1ZXN0LAogICAgICAgICAgICAgICAgICAgICAgICBIdHRwU2VydmxldFJlc3BvbnNlIHJlc3BvbnNlKSB7CiAgICAgICAgdGhpcy5zdXJ2ZXlTZXJ2aWNlID0gbmV3IFN1cnZleVNlcnZpY2Uoc3VydmV5UmVwb3NpdG9yeSk7CiAgICAgICAgdGhpcy5yZXNwb25zZVNlcnZpY2UgPSBuZXcgUmVzcG9uc2VTZXJ2aWNlKHJlc3BvbnNlUmVwb3NpdG9yeSk7CgogICAgICAgIFN1cnZleSBsYXN0U3VydmV5ID0gc3VydmV5U2VydmljZS5maW5kTGFzdCgpOwogICAgICAgIG1vZGVsLnB1dCgic3VydmV5VGl0bGUiLCBsYXN0U3VydmV5LmdldFRpdGxlKCkpOwoKICAgICAgICBMaXN0PFF1ZXN0aW9uPiBxdWVzdGlvbnMgPSBsYXN0U3VydmV5LmdldFF1ZXN0aW9ucygpOwoKICAgICAgICBtb2RlbC5wdXQoInF1ZXN0aW9ucyIsIHF1ZXN0aW9ucyk7CgogICAgICAgIHJldHVybiAiaW5kZXgiOwogICAgfQp9Cg==</textarea>
</div>
</div><div class="saurus-overview"><ul></ul></div></div><div class="saurus-code"><div class="file-path"><span class="crumb-container"></span><i class="fa fa-fw fa-folder"></i></div><div class="saurus-editor"></div></div><div class="saurus-explorer"><div class="saurus-file-list"></div><a href="https://github.com/TwilioDevEd/automated-survey-spring" target="_blank" class="explorer-get-code"> <i class="fa fa-lg fa-github-square"> </i>View Code on GitHub</a></div></div></div></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script><script src="ace/ace.js"></script><script src="ace/theme-monokai.js"></script><script src="viewsaurus.js"></script></body></html>